<div class="wishlist-container">
  <div class="header">
    <h1>Mi Carrito ðŸ›’</h1>
    <button class="btn primary" type="button" (click)="seguirComprando()">
      Seguir comprando
    </button>
  </div>

  @if (loading) {
    <p class="empty">Cargando carrito...</p>
  }

  @if (!loading && errorMsg) {
    <p class="empty error">{{ errorMsg }}</p>
  }

  @if (!loading && items.length === 0) {
    <p class="empty">Tu carrito estÃ¡ vacÃ­o. Agrega productos desde el catÃ¡logo.</p>
  }

  @if (!loading && items.length > 0) {
    <table class="wishlist-table">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Precio</th>
          <th>Cantidad</th>
          <th>Subtotal</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        @for (item of items; track item.id_producto) {
          <tr>
            <td>{{ item.producto?.name }}</td>

            <td>${{ item.producto?.price?.toLocaleString('es-CL') }}</td>

            <td>
              <div class="qty">
                <button class="btn-qty" type="button" (click)="dec(item)">âˆ’</button>

                <input
                  class="qty-input"
                  type="number"
                  [value]="item.cantidad"
                  (change)="onCantidadInput(item, $any($event.target).value)"
                  min="1"
                  [max]="item.producto?.stock ?? 999"
                />

                <button class="btn-qty" type="button" (click)="inc(item)">+</button>
              </div>
            </td>

            <td>
              ${{ ((item.producto?.price ?? 0) * item.cantidad).toLocaleString('es-CL') }}
            </td>

            <td class="acciones">
              <button class="btn-eliminar" type="button" (click)="remove(item)">ðŸ—‘</button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    <!-- âœ… Barra final (Total + CTA) -->
    <div class="checkout-bar">
      <div class="checkout-total">
        <span>Total</span>
        <strong>${{ total.toLocaleString('es-CL') }}</strong>
      </div>

      <button
        class="btn-checkout"
        type="button"
        (click)="checkout()"
        [disabled]="checkoutLoading || loading"
      >
        <span class="icon">ðŸ§¾</span>
        <span class="text">
          {{ checkoutLoading ? 'Procesando...' : 'Finalizar compra' }}
        </span>
      </button>
    </div>

    <p class="empty" *ngIf="checkoutMsg">{{ checkoutMsg }}</p>
  }
</div>